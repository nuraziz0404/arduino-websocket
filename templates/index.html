<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="utf-8">
   <title>Message from Arduino:</title>
   <style>
      table,
      td {
         border: 1px solid #333;
      }

      thead {
         background-color: #333;
         color: #fff;
      }
   </style>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
   <div class="container bg-secondary py-2 rounded mt-3" style="max-width: 500px;">
      <div class="card text-white bg-secondary" id="main" style="display: none;">
         <div class="card-header d-flex justify-content-center">
            <h1>Jemuran Otomatis</h1>
         </div>
         <div class="card-body d-flex justify-content-center">
            <h1>STATUS:</h1>
            &nbsp;
            <h1 id="val"></h1>
         </div>
         <div class="card-body d-flex justify-content-between d-flex mx-auto">
            <button class="btn btn-primary mx-2" onclick="jemur()">JEMUR</button>
            <button class="btn btn-danger mx-2" onclick="teduh()">TEDUHKAN</button>
         </div>
      </div>
      <div class="card text-white bg-secondary justify-content-center" id="loading" style="display: flex;">
         <h1 style="margin: auto;">CONNECTING</h1>
      </div>
   </div>
   <script>

      const urlParams = new URLSearchParams(window.location.search);
      var id = urlParams.get('id');
      // if (!id) alert("mana id nya?\nketik http://" + location.host + "?id=<id jemuran>")
      if (!id) window.location = prompt("please input the id")

      const wsHost = `${window.location.protocol === 'https:' ? 'wss' : 'ws'}://${location.host}`
      console.log("connecting ws: " + wsHost)
      const ws = new WebSocket(wsHost);
      const v = document.getElementById('val');

      console.log("starting jemuran otomatis")

      let x = setInterval(() => {
         if (ws.readyState) {
            ws.send(`client ${id} set`)
            clearInterval(x)
            document.getElementById("loading").style.display = "none"
            document.getElementById("main").style.display = "block"
         }
      }, 100);

      ws.onmessage = function (event) {
         let msg = event.data
         if(msg == "exists") {
            ws.close()
            alert("sabar, gek ono sing ngakses")
         } else v.textContent = msg
      };
      function jemur() {
         ws.send(`client ${id} send jemur`)
      }
      function teduh() {
         ws.send(`client ${id} send teduh`)
      }
   </script>
</body>

</html>